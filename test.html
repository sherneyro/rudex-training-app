<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç - RUDEX Training</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∞ */
        .test-header {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .test-title {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .test-progress {
            font-size: 14px;
            opacity: 0.9;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ */
        .question-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        /* –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ */
        .answers {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .answer {
            padding: 16px;
            background: #f5f5f5;
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .answer:hover {
            background: #e8eaf6;
        }

        .answer input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .answer label {
            flex: 1;
            cursor: pointer;
            font-size: 16px;
        }

        .answer.selected {
            background: #e8eaf6;
            border-color: #667eea;
        }

        .answer.correct {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .answer.wrong {
            background: #ffebee;
            border-color: #f44336;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .test-nav {
            display: flex;
            gap: 12px;
        }

        .btn-submit {
            flex: 1;
            padding: 16px;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-submit:active {
            transform: scale(0.95);
        }

        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç */
        .result-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .result-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .result-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .result-score {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
        }

        .result-message {
            font-size: 16px;
            color: #666;
            margin-bottom: 24px;
        }

        .result-details {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .result-stat {
            text-align: center;
        }

        .result-stat-value {
            font-size: 32px;
            font-weight: bold;
            display: block;
        }

        .result-stat-label {
            font-size: 14px;
            color: #666;
        }

        .pass {
            color: #4caf50;
        }

        .fail {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ—Å—Ç–∞ -->
        <div class="test-header">
            <div class="test-title" id="testTitle">üìù –¢–µ—Å—Ç –ø–æ –ú–æ–¥—É–ª—é 1</div>
            <div class="test-progress" id="testProgress">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 5</div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ -->
        <div id="questionContainer">
            <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="test-nav">
            <button class="btn-submit" id="btnSubmit" onclick="submitTest()">
                –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç
            </button>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <div id="resultContainer" style="display: none;">
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ -->
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.BackButton.show();
        tg.BackButton.onClick(() => {
            window.history.back();
        });

        // –ü–æ–ª—É—á–∞–µ–º ID –º–æ–¥—É–ª—è –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const moduleId = parseInt(urlParams.get('module')) || 1;

        // –î–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤
        const testData = {
            1: {
                name: '–û –∫–æ–º–ø–∞–Ω–∏–∏ RUDEX',
                questions: [
                    {
                        question: '–í –∫–∞–∫–æ–º –≥–æ–¥—É –±—ã–ª–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è RUDEX?',
                        answers: [
                            { text: '2010', correct: false },
                            { text: '2014', correct: true },
                            { text: '2018', correct: false },
                            { text: '2020', correct: false }
                        ]
                    },
                    {
                        question: '–°–∫–æ–ª—å–∫–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ —É –∫–æ–º–ø–∞–Ω–∏–∏ RUDEX?',
                        answers: [
                            { text: '5', correct: false },
                            { text: '6', correct: false },
                            { text: '8', correct: true },
                            { text: '10', correct: false }
                        ]
                    },
                    {
                        question: '–í –∫–∞–∫–æ–º –≥–æ–¥—É RUDEX –≤—ã—à–ª–∞ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å OZON?',
                        answers: [
                            { text: '2022', correct: false },
                            { text: '2023', correct: false },
                            { text: '2024', correct: true },
                            { text: '2025', correct: false }
                        ]
                    },
                    {
                        question: '–ö–∞–∫–æ–π –∫–ª—é—á–µ–≤–æ–π –æ–±—ä–µ–∫—Ç RUDEX —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∞ –≤ –•–∏–º–∫–∞—Ö?',
                        answers: [
                            { text: '–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä', correct: false },
                            { text: '–ó–ê–ì–°', correct: true },
                            { text: '–ë–æ–ª—å–Ω–∏—Ü–∞', correct: false },
                            { text: '–ê—ç—Ä–æ–ø–æ—Ä—Ç', correct: false }
                        ]
                    },
                    {
                        question: '–ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –≥–ª–∞–≤–Ω—ã–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ–º RUDEX?',
                        answers: [
                            { text: '–¢–æ–ª—å–∫–æ –Ω–∏–∑–∫–∏–µ —Ü–µ–Ω—ã', correct: false },
                            { text: '–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∏ –∫–∞—á–µ—Å—Ç–≤–æ', correct: true },
                            { text: '–¢–æ–ª—å–∫–æ —Å–∫–æ—Ä–æ—Å—Ç—å', correct: false },
                            { text: '–¢–æ–ª—å–∫–æ —à–∏—Ä–æ–∫–∏–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç', correct: false }
                        ]
                    }
                ]
            },
            2: {
                name: '–ü—Ä–æ–¥—É–∫—Ç—ã RUDEX',
                questions: [
                    { 
                        question: '–ö–∞–∫–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –≤—Ö–æ–¥–Ω—ã—Ö –¥–≤–µ—Ä–µ–π?',
                        answers: [
                            { text: '800√ó2000 –∏ 900√ó2000', correct: false },
                            { text: '880√ó2050 –∏ 960√ó2050', correct: true },
                            { text: '850√ó2100 –∏ 950√ó2100', correct: false },
                            { text: '900√ó2200 –∏ 1000√ó2200', correct: false }
                        ]
                    }
                    // –î–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
                ]
            }
        };

        let userAnswers = [];
        let currentTest = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∞
        function initTest() {
            currentTest = testData[moduleId];
            if (!currentTest) {
                window.location.href = 'index.html';
                return;
            }

            document.getElementById('testTitle').textContent = `üìù –¢–µ—Å—Ç: ${currentTest.name}`;
            document.getElementById('testProgress').textContent = `${currentTest.questions.length} –≤–æ–ø—Ä–æ—Å–æ–≤`;

            renderQuestions();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
        function renderQuestions() {
            const container = document.getElementById('questionContainer');
            container.innerHTML = '';

            currentTest.questions.forEach((q, qIndex) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-number">–í–æ–ø—Ä–æ—Å ${qIndex + 1} –∏–∑ ${currentTest.questions.length}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="answers" data-question="${qIndex}">
                        ${q.answers.map((a, aIndex) => `
                            <div class="answer" onclick="selectAnswer(${qIndex}, ${aIndex})">
                                <input type="radio" 
                                       id="q${qIndex}_a${aIndex}" 
                                       name="question${qIndex}" 
                                       value="${aIndex}">
                                <label for="q${qIndex}_a${aIndex}">${a.text}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(questionCard);
            });
        }

        // –í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞
        function selectAnswer(questionIndex, answerIndex) {
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–æ–≤ —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
            const answersContainer = document.querySelector(`[data-question="${questionIndex}"]`);
            answersContainer.querySelectorAll('.answer').forEach(a => {
                a.classList.remove('selected');
            });

            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
            const selectedAnswer = answersContainer.children[answerIndex];
            selectedAnswer.classList.add('selected');

            // –û—Ç–º–µ—á–∞–µ–º radio button
            const radio = selectedAnswer.querySelector('input[type="radio"]');
            radio.checked = true;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
            userAnswers[questionIndex] = answerIndex;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç–≤–µ—á–µ–Ω—ã
            checkAllAnswered();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –æ—Ç–≤–µ—á–µ–Ω—ã –ª–∏ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
        function checkAllAnswered() {
            const allAnswered = userAnswers.length === currentTest.questions.length &&
                              userAnswers.every(a => a !== undefined);
            
            document.getElementById('btnSubmit').disabled = !allAnswered;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–∞
        function submitTest() {
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
            let correctCount = 0;
            currentTest.questions.forEach((q, index) => {
                if (userAnswers[index] !== undefined && q.answers[userAnswers[index]].correct) {
                    correctCount++;
                }
            });

            const totalQuestions = currentTest.questions.length;
            const percentage = Math.round((correctCount / totalQuestions) * 100);
            const passed = percentage >= 60;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            showResult(correctCount, totalQuestions, percentage, passed);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            saveTestResult(passed, percentage, correctCount);
        }

        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function showResult(correct, total, percentage, passed) {
            document.getElementById('questionContainer').style.display = 'none';
            document.querySelector('.test-nav').style.display = 'none';

            const resultContainer = document.getElementById('resultContainer');
            resultContainer.style.display = 'block';
            resultContainer.innerHTML = `
                <div class="result-card">
                    <div class="result-icon">${passed ? 'üéâ' : 'üòî'}</div>
                    <div class="result-title ${passed ? 'pass' : 'fail'}">
                        ${passed ? '–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω!' : '–¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω'}
                    </div>
                    <div class="result-score ${passed ? 'pass' : 'fail'}">
                        ${percentage}%
                    </div>
                    <div class="result-message">
                        ${passed ? 
                            '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç –∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –º–æ–¥—É–ª—é.' : 
                            '–í—ã –Ω–∞–±—Ä–∞–ª–∏ –º–µ–Ω—å—à–µ 60%. –ò–∑—É—á–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª –µ—â—ë —Ä–∞–∑ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.'}
                    </div>
                    <div class="result-details">
                        <div class="result-stat">
                            <span class="result-stat-value pass">${correct}</span>
                            <span class="result-stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</span>
                        </div>
                        <div class="result-stat">
                            <span class="result-stat-value fail">${total - correct}</span>
                            <span class="result-stat-label">–û—à–∏–±–æ–∫</span>
                        </div>
                    </div>
                    <div class="test-nav">
                        ${passed ? 
                            `<button class="btn-submit" onclick="goToNextModule()">
                                –°–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å ‚û°Ô∏è
                            </button>` :
                            `<button class="btn-submit" onclick="retryTest()">
                                üîÑ –ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ
                            </button>`
                        }
                        <button class="btn-submit" onclick="goToHome()" style="background: #667eea;">
                            üè† –ì–ª–∞–≤–Ω–∞—è
                        </button>
                    </div>
                </div>
            `;

            window.scrollTo(0, 0);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ç–µ—Å—Ç–∞
        function saveTestResult(passed, percentage, correct) {
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Telegram Bot API
            tg.sendData(JSON.stringify({
                action: 'save_test_result',
                moduleId: moduleId,
                passed: passed,
                percentage: percentage,
                correct: correct,
                total: currentTest.questions.length
            }));

            console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω:', { passed, percentage, correct });
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function retryTest() {
            userAnswers = [];
            document.getElementById('questionContainer').style.display = 'block';
            document.querySelector('.test-nav').style.display = 'flex';
            document.getElementById('resultContainer').style.display = 'none';
            renderQuestions();
        }

        function goToNextModule() {
            const nextModule = moduleId + 1;
            if (nextModule <= 4) {
                window.location.href = `module.html?id=${nextModule}`;
            } else {
                window.location.href = 'certificate.html';
            }
        }

        function goToHome() {
            window.location.href = 'index.html';
        }

        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
        initTest();
    </script>
</body>
</html>
